name: Установить nginx

on:
  push:
    branches:
      - main
jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Установить nginx
        run: |
          sudo apt update && sudo apt install nginx

      - name: Изменить права доступа к файлу конфигурации nginx
        run: |
          sudo chmod 777 /etc/nginx/sites-available/default

      - name: Добавить контент в файл конфигурации nginx
        run: |
          echo "server {
            listen 80;
            server_name localhost;
            location / {
              root /usr/share/nginx/html;
              index index.html;
            }
          }" > /etc/nginx/sites-available/default

      - name: Удалить существующий файл конфигурации nginx
        run: |
          sudo rm -f /etc/nginx/sites-enabled/default

      - name: Проверка конфига nginx
        run: |
         sudo nginx -T
        
      - name: Включить файл конфигурации nginx
        run: |
          sudo ln -s /etc/nginx/sites-available/default /etc/nginx/sites-enabled/default

      - name: Перезапустить nginx
        run: |
          sudo service nginx restart

      - name: Проверить состояние nginx
        run: |
          sudo systemctl status nginx

      - name: Проверить работоспособность nginx
        run: |
          curl localhost
